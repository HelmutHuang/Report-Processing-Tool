# Changelog
## [3.2.0] - 2025-06-22

### 新增功能

- **新增格式规范检查模块**：
  - 在GUI界面增加了“启用格式扣分”的可选开关。
  - 程序可根据8项预设规则（如学生姓名、班级、日期、教师姓名、各部分标题等）自动检查报告格式。
  - 每项不满足规则扣1分，扣分会自动计入最终总分。
  - 导出的Excel成绩表中增加“格式扣分”列，清晰展示此项扣分。
- **增强配置持久化**：现在所有5个可选处理步骤（统一文件名、统一文档格式、启用格式扣分、自动评分评语、导出成绩表格）的勾选状态，都会被完整地保存到 `config.json` 文件中，并在下次启动时自动加载。
- **增加详细诊断日志**：为格式扣分功能增加了详细的日志输出，当存在格式扣分时，会逐条列出具体的不合规项目及其原因，方便快速定位问题。

### 优化与重构

- **重构日期提取逻辑**：将文档日期的提取操作统一为“一次提取，多处使用”，避免了在格式检查、Excel导出和批阅日期计算等多个环节的重复操作，提升了代码效率和可维护性。
- **优化批阅日期计算**：恢复并优化了批阅日期的计算方式。如果报告中能提取到日期，则以此为基准计算批阅日期；如果不能，则使用当前系统日期。
- **优化处理日志**：处理单个文件时的日志输出信息，从只显示文件名，优化为显示从班级文件夹开始的完整相对路径，使处理流程更清晰。
- **代码可读性提升**：对核心处理函数增加了大量中文注释，并对部分冗余代码（如 `log` 函数中的 `moveCursor` 调用）进行了清理。
## [3.1.0] - 2025-06-22

### 新增功能

- **功能模块化**：处理步骤（改名、格式化、评分、导出）已变为完全独立的可选开关，用户可自由组合执行。
- **说明文档外置**：程序的使用说明现在从外部 `README.md` 文件动态加载，方便用户随时查阅和修改。

### 优化与重构

- **重构文件处理流程**：更新了核心逻辑，支持在不勾选“改名报告文件”的情况下，直接对原始文件进行复制和后续操作。
- **界面布局调整**：将可选步骤复选框移入“基本参数设置”区域，并移除了分组框的序号，使界面布局更紧凑、合理。

## [3.0.0] - 2025-06-21

### 图形化界面重构 (GUI Overhaul)

本次为里程碑式的重大更新，程序已从命令行脚本彻底重构为用户友好的GUI桌面应用，并集成了完整的参数配置与持久化功能。

#### 全新图形用户界面 (GUI)
- **从命令行到桌面应用**：程序的核心交互方式从命令行窗口升级为完整的、用户友好的图形界面 。
- **可视化操作与反馈**：用户可以通过点击按钮、选择文件夹、填写输入框等方式完成所有操作，并通过界面中的日志窗口实时查看处理进度与结果 。
- **灵活的路径选择**：支持通过文件对话框自由选择待处理报告所在的文件夹，不再局限于固定的目录结构 。
- **流畅的用户体验**：采用多线程处理耗时任务，将文件处理与界面响应分离，保证了即使在处理大量文件时，主界面依然流畅不卡顿 。

#### 完整的参数配置与持久化
- **引入配置文件与GUI双向同步**: 程序启动时会自动加载`config.json`文件来填充界面；如果文件不存在，则会自动创建一份默认配置 。
- **新增“保存当前配置”按钮**: 用户在界面上做的所有参数修改，都可以通过点击此按钮一次性保存到`config.json`文件中，实现了设置的永久保存 。
- **全面的参数可配置化**: 在GUI中开放了所有核心参数的配置项，包括：教师姓名、批阅日期延迟、完整的评分标准以及相似度检测的启用、扣分阈值和最大扣分值等 。

#### UI/UX 优化与稳定性修复
- **界面优化**: 调整了控件的布局与间距，并优化了“相似度超过(%)则扣分”等标签文案，使界面在视觉上更协调、逻辑上更清晰 。
- **增加控件联动**: 实现了“启用相似度检测”复选框与下方参数项的联动功能，取消勾选后，相关设置项会自动变为灰色不可用状态。

## [2.1.0] - 2025-06-18

### 性能优化与代码重构
- **优化数据加载流程**：程序启动时一次性加载所有数据源（如`名单.xlsx`），避免了在处理过程中反复读取文件，显著降低了I/O开销，提升了整体性能 。
- **提升姓名匹配效率**：通过预先构建高效的姓名查找表（哈希映射），将姓名匹配的速度从循环遍历查找优化为直接映射，大幅提升了文件重命名阶段的效率 。
- **代码结构优化**：重构了部分代码，将加载的数据和配置统一管理，通过参数传递给各功能函数，增强了代码的模块化、可读性和可维护性 。

## [2.0.0] - 2025-06-15

### 核心重构

- **重构报告生成流程**：不再生成多个独立的Excel成绩文件再进行合并。新的工作流在内存中处理所有数据，最后直接生成一份包含所有工作表（分项成绩表+汇总表）的最终报告，显著提高了效率和流程的简洁性 。

### 功能变更

- **增量更新功能重构**：在新架构下重新实现了增量更新。现在运行脚本处理新文件时，程序会读取现有的总报告文件，并将新成绩智能地合并或更新进去，而不是完全覆盖 。

### 修复与优化

- **修复 `FutureWarning`**：通过在内存中创建数据时使用正确的`numpy`数据类型（`np.nan`），彻底解决了多个因数据类型不匹配（Downcasting）导致的 `pandas` 未来版本警告 。
- **优化代码**：移除了在旧版和重构过程中残留的、不再使用的库引用（如 `subprocess`、`json`） 。
- **格式优化**：新增了将最终Excel报告中所有单元格自动居中的功能，使报告更美观 。

## [1.7.0] - 2025-06-09

### 新增功能

- 新增成绩文件自动合并功能：
  - 在处理完所有Word文件后，自动合并所有生成的成绩文件
  - 创建汇总分数工作表，包含所有班级的成绩
  - 保持姓名顺序与第一个工作表一致
  - 自动将空成绩填充为0

### 其他变更

- 优化成绩文件处理流程，提高处理效率

## [1.6.0] - 2025-05-16

### 新增功能

- 将所有配置参数迁移到外部配置文件 `config.json`，包括：
  - 文件夹路径配置
  - 文件名配置
  - 教师信息配置
  - 相似度检测参数配置
  - 评分标准配置
- 新增相似度检测开关功能，可通过配置文件控制是否启用相似度检查
- 为配置文件添加详细的参数说明，方便其他用户理解和修改

### 其他变更

- 优化代码结构，将硬编码的配置参数统一管理
- 改进配置文件的错误处理机制
- 添加配置文件加载失败的友好提示

## [1.5.0] - 2.025-05-10

### 新增功能

- 自动从报告表格第三行第一个单元格提取日期
- 批阅时间自动设置为原日期后三天
- 当无法提取日期时，使用系统当前日期作为批阅日期

### 其他变更

- 优化代码结构，移除未使用的库引用
- 改进日期提取的容错处理

## [1.4.0] - 2025-05-10

### 新增功能

- 将相似度值改为百分比显示，更直观地展示文档相似程度
- 根据相似度比例扣分（100%相似扣20分，90%相似扣10分，80%以下不扣分）
- 将相关参数设置为可自定义，包括最大扣分值、最小扣分值和扣分阈值
- 优化相似度检测流程，先进行相似度检测，然后在批阅文档评分时应用扣分

### 其他变更

- 在成绩表格中新增相似度信息列，包括最大相似度、相似文件和相似度扣分
- 在评语中添加相似度信息，显示相似文件名称、相似度百分比和扣分值
- 优化相似度报告格式，以百分比形式显示相似度值

## [1.3.0] - 2025-04-28

### 新增功能

- 添加文档相似度检测功能，可自动识别实验内容相似度高的报告
- 为每个班级和文件夹生成相似度报告，包含完整相似度矩阵和高相似度文档对
- 添加相似度阈值配置参数，默认为0.8，可根据需要调整

### 其他变更

- 引入 sklearn 库用于文本向量化和相似度计算
- 优化文件处理流程，在处理完成后自动进行相似度检测

## [1.2.0] - 2025-04-18

### 修改功能

- 修改分数计算方式，改为报告中`实验（训）目的与要求`、`实验（训）内容、方法与步骤`、`实验（训）结果与问题讨论`分别评分后相加

### 修复问题

- 当成绩表格被占用时，去除报错并改为提示，允许按键后重新生成成绩表格 。
- 改进名字匹配算法，更精准，不再是匹配第一组中文

## [1.1.0] - 2025-04-14
### 新增功能
- 实现了多文件夹文档同时批阅，并对应生成同名文件夹保存批阅后文件
- 实现了增量替换文件、成绩功能

### 修改功能
- 去除生成班级文件夹名、成绩表格名内的时间戳